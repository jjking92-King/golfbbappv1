<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Golf Battle-Buddy</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    
    <style>
        /* --- General & Reset --- */
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f3f4f6; /* bg-gray-100 */
            margin: 0;
            padding: 0;
            color: #1f2937; /* text-gray-900 */
        }
        
        .container {
            width: 100%;
            max-width: 900px; /* max-w-5xl */
            margin-left: auto;
            margin-right: auto;
            padding: 1rem;
        }

        button, input, select {
            font-family: inherit;
            font-size: 100%;
            margin: 0;
        }

        h1, h2, h3 {
            margin: 0 0 0.5em 0;
            font-weight: 700;
        }
        
        h1 { font-size: 2.25rem; }
        h2 { font-size: 1.875rem; }
        h3 { font-size: 1.5rem; }
        
        p { margin: 0 0 1em 0; }
        ul { margin: 0 0 1em 0; padding-left: 1.5em; }
        li { margin-bottom: 0.5em; }

        /* --- Header & Navigation --- */
        header {
            background-color: #14532d; /* bg-green-900 */
            color: #ffffff;
            padding: 1rem;
            position: sticky;
            top: 0;
            z-index: 1000;
        }
        
        .header-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
            max-width: 900px;
            margin: auto;
            flex-wrap: wrap;
        }
        
        header h1 {
            font-size: 1.5rem;
            font-weight: 700;
            text-transform: uppercase;
        }
        
        header nav {
            display: flex;
            flex-wrap: wrap;
            align-items: center;
        }

        .nav-link {
            background: none;
            border: none;
            color: #ffffff;
            padding: 0.5rem 1rem;
            border-radius: 0.375rem;
            font-size: 0.875rem;
            font-weight: 500;
            cursor: pointer;
            text-decoration: none;
        }
        
        .nav-link:hover {
            background-color: #166534; /* hover:bg-green-700 */
        }
        
        /* Active state for nav links */
        .nav-link.active {
            background-color: #166534;
            color: #ffffff;
        }

        /* --- Auth Section (in header) --- */
        #auth-container {
            margin-left: 0.5rem;
        }

        #user-info {
            display: none; /* Hidden by default */
            align-items: center;
        }
        #user-info.active {
            display: flex; /* Shown by JS */
        }
        
        #user-welcome {
            font-size: 0.875rem;
            margin-right: 0.5rem;
        }

        /* --- Main Content & Pages --- */
        main {
            padding: 2rem 1rem;
        }

        .page-content {
            display: none; /* All pages hidden by default */
        }
        
        .page-content.active {
            display: block; /* Active page is shown */
        }

        /* Card / Box style */
        .card {
            background-color: #ffffff;
            border-radius: 0.5rem;
            box-shadow: 0 4px 6px -1px rgba(0,0,0,0.1), 0 2px 4px -2px rgba(0,0,0,0.1);
            padding: 1.5rem;
        }

        /* --- Forms --- */
        form {
            background-color: #f9fafb; /* bg-gray-100 */
            padding: 1rem;
            border-radius: 0.5rem;
            margin-bottom: 1.5rem;
            border: 1px solid #e5e7eb;
        }
        
        form div {
            margin-bottom: 0.75rem;
        }
        
        label {
            display: block;
            font-size: 0.875rem;
            font-weight: 500;
            color: #374151; /* text-gray-700 */
            margin-bottom: 0.25rem;
        }
        
        input[type="text"], input[type="password"], select {
            width: 100%;
            padding: 0.5rem;
            border: 1px solid #d1d5db; /* border-gray-300 */
            border-radius: 0.375rem;
            box-sizing: border-box; /* Ensures padding doesn't affect width */
        }
        
        input[readonly] {
            background-color: #e5e7eb; /* bg-gray-200 */
        }

        /* --- Buttons --- */
        button {
            cursor: pointer;
            padding: 0.5rem 1rem;
            border: none;
            border-radius: 0.375rem;
            font-weight: 500;
            font-size: 0.875rem;
        }
        
        .btn {
            padding: 0.6rem 1.2rem;
            font-size: 1rem;
        }

        .btn-blue {
            background-color: #2563eb; /* bg-blue-600 */
            color: white;
        }
        .btn-blue:hover { background-color: #3b82f6; }

        .btn-red {
            background-color: #dc2626; /* bg-red-600 */
            color: white;
        }
        .btn-red:hover { background-color: #ef4444; }

        .btn-green {
            background-color: #16a34a; /* btn green */
            color: white;
        }
        .btn-green:hover { background-color: #22c55e; }

        .btn-yellow {
            background-color: #f59e0b; /* bg-yellow-500 */
            color: #422006;
        }
        .btn-yellow:hover { background-color: #facc15; }
        
        .btn-gray {
            background-color: #ffffff;
            color: #374151;
            border: 1px solid #d1d5db;
        }
        .btn-gray:hover { background-color: #f9fafb; }
        
        button:disabled {
            background-color: #9ca3af; /* bg-gray-400 */
            color: #e5e7eb;
            cursor: not-allowed;
        }

        /* --- Tee Time List --- */
        #login-prompt {
            background-color: #fefce8; /* bg-yellow-100 */
            border-left: 4px solid #facc15; /* border-yellow-500 */
            color: #a16207; /* text-yellow-700 */
            padding: 1rem;
            margin-bottom: 1rem;
            border-radius: 0.25rem;
        }
        #login-prompt-btn {
            font-weight: bold;
            text-decoration: underline;
            background: none;
            padding: 0;
            color: inherit;
        }

        .tee-time-group {
            border: 1px solid #e5e7eb;
            border-radius: 0.5rem;
            padding: 1rem;
            background-color: #f9fafb; /* bg-gray-50 */
            margin-bottom: 1rem;
        }
        
        .tee-time-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            margin-bottom: 0.75rem;
        }
        
        .tee-time-details {
            border-top: 1px solid #e5e7eb;
            padding-top: 0.75rem;
        }

        /* Skill Badges */
        .skill-badge {
            font-size: 0.75rem;
            font-weight: 500;
            padding: 0.125rem 0.5rem;
            border-radius: 9999px;
            display: inline-block;
        }
        .skill-beginner { background-color: #dbeafe; color: #1e40af; } /* blue */
        .skill-intermediate { background-color: #fef9c3; color: #854d0e; } /* yellow */
        .skill-advanced { background-color: #fee2e2; color: #991b1b; } /* red */
        .skill-unknown { background-color: #e5e7eb; color: #374151; } /* gray */
        
        /* --- About Page Specific --- */
        .about-layout {
            display: flex;
            align-items: flex-start;
            gap: 1.5rem;
        }
        .about-photo {
            width: 192px;
            height: 192px;
            object-fit: cover;
            border-radius: 0.5rem;
            box-shadow: 0 4px 6px -1px rgba(0,0,0,0.1);
        }
        @media (max-width: 640px) {
            .about-layout { flex-direction: column; }
        }

        /* --- User Guide Specific --- */
        .step-number {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            height: 3rem;
            width: 3rem;
            border-radius: 9999px;
            background-color: #14532d; /* bg-green-900 */
            color: white;
            font-weight: 700;
            font-size: 1.5rem;
            margin-bottom: 0.75rem;
        }

        /* --- Modal Styles --- */
        .modal {
            display: none; /* Hidden by default */
            position: fixed;
            z-index: 2000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            overflow: auto;
            background-color: rgba(0, 0, 0, 0.5); /* Dim background */
            justify-content: center;
            align-items: center;
        }
        
        .modal.is-open {
            display: flex; /* Show modal */
        }
        
        .modal-content {
            background-color: #ffffff;
            margin: auto;
            padding: 1.5rem;
            border-radius: 0.5rem;
            box-shadow: 0 10px 15px -3px rgba(0,0,0,0.1);
            width: 90%;
            max-width: 500px;
        }
        
        .modal-buttons {
            display: flex;
            justify-content: flex-end;
            gap: 0.75rem;
            margin-top: 1.5rem;
        }

        /* --- Footer --- */
        footer {
            text-align: center;
            padding: 1.5rem;
            color: #4b5563; /* text-gray-600 */
            font-size: 0.875rem;
            margin-top: 2rem;
        }
    </style>
</head>
<body>

    <header>
        <div class="header-content">
            <h1>Golf Battle-Buddy</h1>
            <nav aria-label="main navigation">
                <button class="nav-link" data-page="tee-times" aria-label="Tee Times">Tee Times</button>
                <button class="nav-link" data-page="calendar" aria-label="Calendar">Calendar</button>
                <button class="nav-link" data-page="app-info" aria-label="Application Info">App Info</button>
                <button class="nav-link" data-page="user-guide" aria-label="User Guide">User Guide</button>
                <button class="nav-link" data-page="marketing" aria-label="Marketing">Marketing</button>
                <button class="nav-link" data-page="about" aria-label="About">About</button>
                
                <div id="auth-container">
                    <button id="login-btn" class="btn-blue">Login</button>
                    <div id="user-info">
                        <span id="user-welcome"></span>
                        <button id="logout-btn" class="btn-red">Logout</button>
                    </div>
                </div>
            </nav>
        </div>
    </header>

    <main class="container">
        
        <section id="page-tee-times" class="page-content card">
            <h2>Available Tee Times</h2>
            
            <div id="login-prompt">
                <p>Please <button id="login-prompt-btn">log in</button> to create or join a group.</p>
            </div>

            <form id="create-tee-time-form" autocomplete="off" style="display: none;">
                <h3>Create New Tee Time</h3>
                <div>
                    <label for="player-name">Your Name</label>
                    <input type="text" id="player-name" name="player-name" required aria-required="true" readonly>
                </div>
                <div>
                    <label for="player-skill">Your Skill</label>
                    <select id="player-skill" name="player-skill" required aria-required="true">
                        <option value="" disabled selected>Select skill</option>
                        <option value="Beginner">Beginner +24</option>
                        <option value="Intermediate">Intermediate +10-20</option>
                        <option value="Advanced">Advanced 0 to +10</option>
                    </select>
                </div>
                <div>
                    <label for="tee-date">Date</label>
                    <select id="tee-date" name="tee-date" required aria-required="true">
                        </select>
                </div>
                <div>
                    <label for="tee-time">Time</label>
                    <select id="tee-time" name="tee-time" required aria-required="true">
                        <option value="" disabled selected>Select a time</option>
                        </select>
                </div>
                <button type="submit" class="btn-blue">Create Group</button>
            </form>
            
            <div id="tee-times-list">
                <p>Loading tee times...</p>
            </div>
        </section>
        
        <section id="page-calendar" class="page-content card">
            <h2>Upcoming Events</h2>
            <ul id="calendar-list">
                </ul>
        </section>

        <section id="page-app-info" class="page-content card">
            <h2>Application Information</h2>
            <div>
                <h3>Core Features</h3>
                <ul>
                    <li><strong>Real-time Tee Times:</strong> See available groups for today and tomorrow.</li>
                    <li><strong>Create a Group:</strong> Don't see a time you like? Create your own group and let others join you.</li>
                    <li><strong>Join a Group:</strong> Instantly join an existing group with the click of a button.</li>
                    <li><strong>Skill Level Display:</strong> Players can set their skill level (Beginner, Intermediate, Advanced) to find the right match.</li>
                    <li><strong>Event Calendar:</strong> A simple view of upcoming official course events like tournaments and scrambles.</li>
                </ul>
            </div>
            <div>
                <h3>Technical Specifications</h3>
                 <ul>
                    <li><strong>Frontend:</strong> HTML5, CSS, and modern JavaScript.</li>
                    <li><strong>Backend:</strong> Amazon Web Services S3 and Elastic Beanstalk, Python(Flask).</li>
                    <li><strong>Database:</strong> Amazon Web Services RDS, Google Cloud.</li>
                    <li><strong>Authentication:</strong> Session and Token based Login (simulated with Local/Session Storage in this prototype).</li>
                </ul>
            </div>
        </section>

        <section id="page-user-guide" class="page-content card">
            <h2>How-To: User Guide</h2>
            
            <div>
                <span class="step-number">1</span>
                <h3>Log In</h3>
                <p>Click the "Login" button in the header. Since this is a prototype, you can enter any username and password to log in. Your username will be used to identify you in groups.</p>
            </div>
            
            <div>
                <span class="step-number">2</span>
                <h3>Create a Group</h3>
                 <ul>
                    <li>Once logged in, the "Create New Tee Time" form will appear.</li>
                    <li>Your name is auto-filled.</li>
                    <li>Select your skill level (e.g., "Beginner").</li>
                    <li>Choose a date ("Today" or "Tomorrow") and a time.</li>
                    <li>Click "Create Group." Your new group will instantly appear in the list.</li>
                </ul>
            </div>

            <div>
                <span class="step-number">3</span>
                <h3>Join a Group</h3>
                 <ul>
                    <li>Find a group in the "Tee Times" list that isn't full.</li>
                    <li>Click the green "Join Group" button.</li>
                    <li>A pop-up will ask you to confirm your skill level.</li>
                    <li>Click "Join" in the pop-up, and your name will be added to the list for everyone to see.</li>
                </ul>
            </div>
        </section>

        <section id="page-marketing" class="page-content card">
            <h2>Marketing</h2>
             <div>
                <h3>The Problem</h3>
                <p>You want to play a round of golf, but your usual partners are busy or deployed. You're stuck going to the course as a single, hoping to get paired up, or not going at all.</p>
            </div>
             <div>
                <h3>The Solution: Golf Battle-Buddy</h3>
                <p>A simple web app just for local golf course patrons to use. No downloads, no complex sign-ups. Just log in, see who's playing, and request to join them. Better than the white board method some pro-shops use to track tee times.</p>
            </div>
            <div>
                <h3>Target Audience</h3>
                 <ul>
                    <li>Active Duty Service Members</li>
                    <li>Reservists & National Guard</li>
                    <li>Veterans & Retirees</li>
                    <li>Authorized Civilians, Family Members & Patrons</li>
                </ul>
            </div>
        </section>
        
        <section id="page-about" class="page-content card">
            <h2>About</h2>
            
            <div class="about-layout">
                <div>
                    <img src="images/about-photo.jpg" alt="Photo of Jonathan King" class="about-photo" />
                </div>
                <div>
                    <p>
                        Hello, I’m Jonathan King—a student, a veteran and golf lover. If you’ve ever been stationed somewhere new or had your schedule constantly changing, you know how hard it can be to find someone to hit the links with. That’s why I built Golf Battle-Buddy: A simple webapp for members of the military community to connect and tee off together, no matter where life takes them.
                    </p>
                    <p style="background-color: #f0fdf4; border: 1px solid #bbf7d0; padding: 0.75rem; border-radius: 0.25rem;">
                        <strong>Questions or comments you can send to:</strong> jjking25@hotmail.com
                    </p>
                </div>
            </div>
            
            <hr style="margin: 2rem 0;">

            <div>
                <h3>About This Prototype</h3>
                <p>
                    This application was designed and developed by Jonathan King. As a student, veteran and golf enthusiast, I saw a need for an easy-to-use tool for the local military community to use to connect. With it being such a transient community, it can be hard to find a partner for a tee time, especially with all the varying schedules. This app aims to fix that.
                </p>
                <p>
                    <strong>This is a prototype to test the functionality. All data is for testing only and stored in your local browser.</strong>
                </p>
                <button id="donate-btn" class="btn-yellow" style="width: 100%; margin-top: 1.5rem;">
                    Future Donation Link
                </button>
            </div>
        </section>
        
    </main>
    
    <div id="app-modal" class="modal" role="dialog" aria-modal="true" aria-labelledby="modal-title" aria-describedby="modal-message" tabindex="-1">
        <div class="modal-content">
            <h3 id="modal-title">Notice</h3>
            <p id="modal-message">This is a modal message.</p>
            <div class="modal-buttons" style="justify-content: center;">
                <button id="modal-close-btn" class="btn-green" aria-label="Close modal">
                    Close
                </button>
            </div>
        </div>
    </div>

    <div id="join-modal" class="modal" role="dialog" aria-modal="true" aria-labelledby="join-modal-title" tabindex="-1">
        <div class="modal-content">
            <form id="join-group-form" autocomplete="off" style="padding: 0; background: none; border: none;">
                <h3 id="join-modal-title">Join Group</h3>
                <p id="join-group-info">You are joining...</p>
                
                <input type="hidden" id="join-group-index">
                <div>
                    <label for="join-player-name">Your Name</label>
                    <input type="text" id="join-player-name" required aria-required="true" readonly>
                </div>
                <div>
                    <label for="join-player-skill">Your Skill</LabeL>
                    <select id="join-player-skill" required aria-required="true">
                        <option value="" disabled selected>Select skill</option>
                        <option value="Beginner">Beginner +24</option>
                        <option value="Intermediate">Intermediate +10-20</option>
                        <option value="Advanced">Advanced 0 to +10</option>
                    </select>
                </div>
                
                <div class="modal-buttons">
                    <button type="button" id="join-modal-cancel" class="btn-gray">
                        Cancel
                    </button>
                    <button type="submit" class="btn-green">
                        Join
                    </button>
                </div>
            </form>
        </div>
    </div>

    <div id="auth-modal" class="modal" role="dialog" aria-modal="true" aria-labelledby="auth-modal-title" tabindex="-1">
        <div class="modal-content">
            <form id="auth-form" autocomplete="off" style="padding: 0; background: none; border: none;">
                <h3 id="auth-modal-title" style="text-align: center;">Login</h3>
                <div>
                    <label for="auth-username">Username</label>
                    <input type="text" id="auth-username" autocomplete="username" required>
                </div>
                <div>
                    <label for="auth-password">Password</label>
                    <input type="password" id="auth-password" autocomplete="current-password" required>
                    <p style="font-size: 0.75rem; color: #4b5563; margin-top: 0.25rem;">Hint: This is a simulation. Any password will work.</p>
                </div>
                <div class="modal-buttons">
                     <button type="button" id="auth-modal-cancel" class="btn-gray">
                        Cancel
                    </button>
                    <button type="submit" id="auth-submit-btn" class="btn-blue">
                        Login
                    </button>
                </div>
            </form>
        </div>
    </div>
    
    <footer>
        <p>A project by Jonathan King. Not an official MWR or DoD application.</p>
    </footer>

    <script>
        // --- App State ---
        let TeeTimes = [];
        let authUser = null; // { name: "John Doe", skill: "Beginner" }

        // --- Date Helpers ---
        const today = new Date();
        const tomorrow = new Date();
        tomorrow.setDate(today.getDate() + 1);
        
        const getMonthAbbr = (date) => date.toLocaleString('default', { month: 'short' });
        const todayDateStr = `${getMonthAbbr(today)} ${today.getDate()}`; // e.g., "Nov 8"
        const tomorrowDateStr = `${getMonthAbbr(tomorrow)} ${tomorrow.getDate()}`; // e.g., "Nov 9"
        
        // --- Persistent State Helpers (localStorage) ---
        function loadTeeTimes() {
            const stored = localStorage.getItem('TeeTimes');
            let allTimes = [];
            if (stored) {
                allTimes = JSON.parse(stored);
            }
            
            let validTimes = allTimes.filter(t => t.date === todayDateStr || t.date === tomorrowDateStr);
            
            if (validTimes.length === 0 && !stored) {
                 validTimes = [
                    { date: todayDateStr, time: "08:00", slots: 4, players: [ { name: "Major. Slice", skill: "Advanced" }, { name: "Capt. Hook", skill: "Beginner" } ] },
                    { date: todayDateStr, time: "09:00", slots: 2, players: [ { name: "Sgt. Eagle", skill: "Advanced" } ] },
                    { date: tomorrowDateStr, time: "08:20", slots: 4, players: [ { name: "Fred. Miller", skill: "Intermediate" } ] }
                ];
            }
            
            TeeTimes = validTimes;
            saveTeeTimes();
        }
        
        function saveTeeTimes() {
            TeeTimes.sort((a, b) => {
                if (a.date < b.date) return -1;
                if (a.date > b.date) return 1;
                if (a.time < b.time) return -1;
                if (a.time > b.time) return 1;
                return 0;
            });
            localStorage.setItem('TeeTimes', JSON.stringify(TeeTimes));
        }

        async function addTeeTime(newTeeTime) {
            const existing = TeeTimes.find(t => t.date === newTeeTime.date && t.time === newTeeTime.time);
            if (existing) {
                return { success: false, message: `A tee time for ${newTeeTime.time} on ${newTeeTime.date} already exists.` };
            }
            TeeTimes.push(newTeeTime);
            saveTeeTimes();
            return { success: true, message: `Your tee time for ${newTeeTime.time} on ${newTeeTime.date} has been created.` };
        }

        async function joinTeeTime(index, newPlayer) {
            if (TeeTimes[index] && TeeTimes[index].players.length < TeeTimes[index].slots) {
                TeeTimes[index].players.push(newPlayer);
                saveTeeTimes();
                return { success: true, message: "You have been added to this group. See you on the green!" };
            }
            return { success: false, message: "Could not join group. It might be full." };
        }
        
        // --- Simple Auth Helpers (sessionStorage) ---
        function loginUser(name, skill) {
            authUser = { name: name, skill: skill || "Beginner" };
            sessionStorage.setItem('golfUser', JSON.stringify(authUser));
            updateUIForLoggedIn();
        }
        
        function logoutUser() {
            authUser = null;
            sessionStorage.removeItem('golfUser');
            updateUIForLoggedOut();
        }
        
        function checkLoginState() {
            const storedUser = sessionStorage.getItem('golfUser');
            if (storedUser) {
                authUser = JSON.parse(storedUser);
                updateUIForLoggedIn();
            } else {
                authUser = null;
                updateUIForLoggedOut();
            }
            loadTeeTimes();
            renderTeeTimes();
        }

        // --- UI Update Functions ---
        function updateUIForLoggedIn() {
            document.getElementById('login-btn').style.display = 'none';
            document.getElementById('user-info').style.display = 'flex';
            document.getElementById('user-welcome').textContent = `Welcome, ${authUser.name}!`;
            document.getElementById('login-prompt').style.display = 'none';
            document.getElementById('create-tee-time-form').style.display = 'block';
            document.getElementById('player-name').value = authUser.name;
            document.getElementById('player-skill').value = authUser.skill || "Beginner";
            renderTeeTimes();
        }
        function updateUIForLoggedOut() {
            document.getElementById('login-btn').style.display = 'block';
            document.getElementById('user-info').style.display = 'none';
            document.getElementById('login-prompt').style.display = 'block';
            document.getElementById('create-tee-time-form').style.display = 'none';
            renderTeeTimes();
        }

        // Skill badge
        function getSkillBadge(skill) {
            const normSkill = String(skill).toLowerCase();
            if (normSkill.includes('beginner')) {
                return `<span class="skill-badge skill-beginner">Beginner</span>`;
            } else if (normSkill.includes('intermediate')) {
                return `<span class="skill-badge skill-intermediate">Intermediate</span>`;
            } else if (normSkill.includes('advanced')) {
                return `<span class="skill-badge skill-advanced">Advanced</span>`;
            } else {
                return `<span class="skill-badge skill-unknown">Unknown</span>`;
            }
        }

        // --- Rendering Tee Times with indexed keys ---
        function renderTeeTimes() {
            const listElement = document.getElementById('tee-times-list');
            if (!listElement) return;
            listElement.innerHTML = '';
            
            const todayTimes = TeeTimes.filter(t => t.date === todayDateStr);
            const tomorrowTimes = TeeTimes.filter(t => t.date === tomorrowDateStr);

            function renderDayList(dayTitle, times, dateStr) {
                let dayHtml = `<h3>${dayTitle}</h3>`;
                if (times.length === 0) {
                    dayHtml += `<p style="color: #4b5563; font-style: italic;">No tee times available for this day.</p>`;
                    return dayHtml;
                }
                times.forEach((group) => {
                    const globalIdx = TeeTimes.findIndex(t => t.date === group.date && t.time === group.time);
                    const slotsLeft = group.slots - group.players.length;
                    const playersHtml = group.players.length > 0 ?
                        group.players.map(p =>
                            `<li style="display: flex; justify-content: space-between; align-items: center; padding: 0.25rem 0;">
                                <span>${p.name}</span>
                                ${getSkillBadge(p.skill)}
                            </li>`
                        ).join('') :
                        `<li style="color: #4b5563; font-style: italic;">No players joined yet.</li>`;
                    
                    const isFull = slotsLeft <= 0;
                    const isLoggedIn = !!authUser;
                    const alreadyJoined = isLoggedIn && group.players.some(p => p.name === authUser.name);
                    const joinDisabled = isFull || !isLoggedIn || alreadyJoined;
                    
                    let btnText = "Login to Join";
                    if (isLoggedIn) {
                        btnText = alreadyJoined ? "Joined" : (isFull ? "Full" : "Join Group");
                    }
                    
                    dayHtml += `
                    <div class="tee-time-group">
                        <div class="tee-time-header">
                            <div>
                                <h3 style="color: #14532d;">${group.time}</h3>
                                <p style="font-size: 0.875rem; color: #4b5563;">${slotsLeft} of ${group.slots} slots available</p>
                            </div>
                            <button class="join-btn btn-green"
                                    data-group-index="${globalIdx}"
                                    data-group-info="the ${group.time} group on ${group.date}"
                                    aria-label="Join this group at ${group.time} on ${dateStr}"
                                    ${joinDisabled ? 'disabled' : ''}>
                                    ${btnText}
                            </button>
                        </div>
                        <div class="tee-time-details">
                            <h4 style="font-weight: 600; font-size: 0.875rem; margin-bottom: 0.5rem;">Players Joined:</h4>
                            <ul style="list-style-type: none; padding-left: 0;">${playersHtml}</ul>
                        </div>
                    </div>`
                });
                return dayHtml;
            }
            listElement.innerHTML += renderDayList(`Today, ${todayDateStr}`, todayTimes, todayDateStr);
            listElement.innerHTML += renderDayList(`Tomorrow, ${tomorrowDateStr}`, tomorrowTimes, tomorrowDateStr);
        }

        // --- Modals ---
        const modal = document.getElementById('app-modal');
        const modalTitle = document.getElementById('modal-title');
        const modalMessage = document.getElementById('modal-message');
        const closeModalBtn = document.getElementById('modal-close-btn');
        let lastFocusedElement = null;

        function showModal(title, message) {
            lastFocusedElement = document.activeElement;
            modalTitle.textContent = title;
            modalMessage.textContent = message;
            modal.classList.add('is-open');
            modal.setAttribute('aria-hidden', 'false');
            document.body.style.overflow = "hidden";
            closeModalBtn.focus();
        }
        function closeModal() {
            modal.classList.remove('is-open');
            modal.setAttribute('aria-hidden', 'true');
            document.body.style.overflow = "";
            if (lastFocusedElement) lastFocusedElement.focus();
        }
        modal.addEventListener('keydown', (e) => {
            if (e.key === 'Escape') closeModal();
            if (e.key === 'Tab') { e.preventDefault(); closeModalBtn.focus(); }
        });
        closeModalBtn.addEventListener('click', closeModal);
        modal.addEventListener('click', (e) => {
            if (e.target === modal) closeModal();
        });

        // Join Group Modal
        const joinModal = document.getElementById('join-modal');
        const joinModalForm = document.getElementById('join-group-form');
        const joinModalInfo = document.getElementById('join-group-info');
        const joinModalIndexInput = document.getElementById('join-group-index');
        const joinModalNameInput = document.getElementById('join-player-name');
        const joinModalSkillSelect = document.getElementById('join-player-skill');
        const joinModalCancelBtn = document.getElementById('join-modal-cancel');
        let joinModalLastFocus = null;

        function showJoinModal(index, info) {
            joinModalLastFocus = document.activeElement;
            joinModalInfo.textContent = `You are joining ${info}.`;
            joinModalIndexInput.value = index;
            joinModalForm.reset(); 
            joinModalNameInput.value = authUser.name;
            joinModalSkillSelect.value = authUser.skill || "Beginner";
            
            joinModal.classList.add('is-open');
            joinModal.setAttribute('aria-hidden', 'false');
            document.body.style.overflow = "hidden";
            joinModalSkillSelect.focus();
        }
        function hideJoinModal() {
            joinModal.classList.remove('is-open');
            joinModal.setAttribute('aria-hidden', 'true');
            document.body.style.overflow = "";
            if (joinModalLastFocus) joinModalLastFocus.focus();
        }
        joinModal.addEventListener('keydown', (e) => {
            if (e.key === 'Escape') hideJoinModal();
        });
        joinModalCancelBtn.addEventListener('click', hideJoinModal);
        joinModal.addEventListener('click', (e) => {
            if (e.target === joinModal) hideJoinModal();
        });

        // Auth Modal
        const authModal = document.getElementById('auth-modal');
        const authModalForm = document.getElementById('auth-form');
        const authModalCancelBtn = document.getElementById('auth-modal-cancel');
        const authUsernameInput = document.getElementById('auth-username');
        const authPasswordInput = document.getElementById('auth-password');
        let authModalLastFocus = null;
        
        function showAuthModal() {
            authModalLastFocus = document.activeElement;
            authModalForm.reset();
            authModal.classList.add('is-open');
            authModal.setAttribute('aria-hidden', 'false');
            document.body.style.overflow = "hidden";
            authUsernameInput.focus();
        }
        function hideAuthModal() {
            authModal.classList.remove('is-open');
            authModal.setAttribute('aria-hidden', 'true');
            document.body.style.overflow = "";
            if (authModalLastFocus) authModalLastFocus.focus();
        }
        authModal.addEventListener('keydown', (e) => {
            if (e.key === 'Escape') hideAuthModal();
        });
        authModalCancelBtn.addEventListener('click', hideAuthModal);
        authModal.addEventListener('click', (e) => {
            if (e.target === authModal) hideAuthModal();
        });
        authModalForm.addEventListener('submit', async (e) => {
            e.preventDefault();
            const username = authUsernameInput.value;
            if (username && username.trim() !== "") {
                loginUser(username.trim(), "Beginner");
                hideAuthModal();
            } else {
                showModal("Login Failed", "Please enter a username.");
            }
        });
        
        // --- Page switching utility (safe DOM queries at runtime) ---
        function showPage(pageId) {
            // Query DOM now to ensure we have current nodes
            const allPages = document.querySelectorAll('.page-content');
            const allNavLinks = document.querySelectorAll('.nav-link');

            // Hide all pages
            allPages.forEach(page => {
                page.classList.remove('active');
            });
            // Show the target page
            const targetPage = document.getElementById('page-' + pageId);
            if (targetPage) {
                targetPage.classList.add('active');
            }
            
            // Update active link
            allNavLinks.forEach(link => {
                link.classList.remove('active');
                if(link.dataset.page === pageId) {
                    link.classList.add('active');
                }
            });
            
            // Update page title
            const pageName = pageId.charAt(0).toUpperCase() + pageId.slice(1).replace('-', ' ');
            document.title = `Golf Battle-Buddy | ${pageName}`;
        }


        // --- Page load setup ---
        document.addEventListener('DOMContentLoaded', () => {

            function populateDateSelect() {
                const dateSelect = document.getElementById('tee-date');
                if (!dateSelect) return;
                dateSelect.innerHTML = `
                    <option value="${todayDateStr}">Today, ${todayDateStr}</option>
                    <option value="${tomorrowDateStr}">Tomorrow, ${tomorrowDateStr}</option>
                `;
            }
            
            function populateTimeSelect() {
                const timeSelect = document.getElementById('tee-time');
                if (!timeSelect) return;
                timeSelect.innerHTML = '<option value="" disabled selected>Select a time</option>';
                for (let minutes = 7 * 60; minutes <= 15 * 60 + 20; minutes += 20) {
                    const h = String(Math.floor(minutes / 60)).padStart(2, '0');
                    const m = String(minutes % 60).padStart(2, '0');
                    const timeStr = `${h}:${m}`;
                    const option = document.createElement('option');
                    option.value = timeStr;
                    option.textContent = timeStr;
                    timeSelect.appendChild(option);
                }
            }

            function populateCalendar() {
                const calendarList = document.getElementById('calendar-list');
                if (!calendarList) return;
                const events = [
                    { date: tomorrowDateStr, event: "Sunday Skins Game" },
                    { date: "Nov 11", event: "Veterans Day Scramble" },
                    { date: "Nov 15", event: "Turkey Shootout" },
                    { date: "Nov 16", event: "Weekly Skins Game" }
                ];
                
                let eventsHtml = "";
                events.forEach(item => {
                    eventsHtml += `<li style="padding: 0.5rem 0;">`;
                });
            });
        });
    </script>
</body>
</html>