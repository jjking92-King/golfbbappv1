<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Golf Battle-Buddy</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    
    <style>
        /* --- General & Reset --- */
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f3f4f6; /* bg-gray-100 */
            margin: 0;
            padding: 0;
            color: #1f2937; /* text-gray-900 */
        }
        
        .container {
            width: 100%;
            max-width: 900px; /* max-w-5xl */
            margin-left: auto;
            margin-right: auto;
            padding: 1rem;
        }

        button, input, select {
            font-family: inherit;
            font-size: 100%;
            margin: 0;
        }

        h1, h2, h3 { margin: 0 0 0.5em 0; font-weight: 700; }
        h1 { font-size: 2.25rem; }
        h2 { font-size: 1.875rem; }
        h3 { font-size: 1.5rem; }
        p { margin: 0 0 1em 0; }
        ul { margin: 0 0 1em 0; padding-left: 1.5em; }
        li { margin-bottom: 0.5em; }

        /* --- Header & Navigation --- */
        header { background-color: #14532d; color: #ffffff; padding: 1rem; position: sticky; top: 0; z-index: 1000; }
        .header-content { display: flex; justify-content: space-between; align-items: center; max-width: 900px; margin: auto; flex-wrap: wrap; }
        header h1 { font-size: 1.5rem; font-weight: 700; text-transform: uppercase; }
        header nav { display: flex; flex-wrap: wrap; align-items: center; gap: 0.25rem; }

        .nav-link { background: none; border: none; color: #ffffff; padding: 0.45rem 0.8rem; border-radius: 0.375rem; font-size: 0.875rem; font-weight: 500; cursor: pointer; text-decoration: none; }
        .nav-link:hover { background-color: #166534; }
        .nav-link.active { background-color: #166534; color: #ffffff; }

        #auth-container { margin-left: 0.5rem; display:flex; gap:0.5rem; align-items:center; }
        #user-info { display: none; align-items: center; gap:0.5rem; }
        #user-info.active { display:flex; }
        #user-welcome { font-size: 0.875rem; margin-right: 0.5rem; }

        /* --- Main Content & Pages --- */
        main { padding: 2rem 1rem; }
        .page-content { display: none; }
        .page-content.active { display: block; }
        .card { background-color: #ffffff; border-radius: 0.5rem; box-shadow: 0 4px 6px -1px rgba(0,0,0,0.1), 0 2px 4px -2px rgba(0,0,0,0.1); padding: 1.5rem; }

        /* --- Forms --- */
        form { background-color: #f9fafb; padding: 1rem; border-radius: 0.5rem; margin-bottom: 1.5rem; border: 1px solid #e5e7eb; }
        form div { margin-bottom: 0.75rem; }
        label { display:block; font-size:0.875rem; font-weight:500; color:#374151; margin-bottom:0.25rem; }
        input[type="text"], input[type="password"], select { width:100%; padding:0.5rem; border:1px solid #d1d5db; border-radius:0.375rem; box-sizing:border-box; }
        input[readonly] { background-color:#e5e7eb; }

        /* --- Buttons --- */
        button { cursor:pointer; padding:0.5rem 1rem; border:none; border-radius:0.375rem; font-weight:500; font-size:0.875rem; }
        .btn { padding:0.6rem 1.2rem; font-size:1rem; }
        .btn-blue { background-color:#2563eb; color:white; }
        .btn-blue:hover { background-color:#3b82f6; }
        .btn-red { background-color:#dc2626; color:white; }
        .btn-red:hover { background-color:#ef4444; }
        .btn-green { background-color:#16a34a; color:white; }
        .btn-green:hover { background-color:#22c55e; }
        .btn-yellow { background-color:#f59e0b; color:#422006; }
        .btn-yellow:hover { background-color:#facc15; }
        .btn-gray { background-color:#ffffff; color:#374151; border:1px solid #d1d5db; }
        .btn-gray:hover { background-color:#f9fafb; }
        button:disabled { background-color:#9ca3af; color:#e5e7eb; cursor:not-allowed; }

        /* --- Tee Time List --- */
        #login-prompt { background-color:#fefce8; border-left:4px solid #facc15; color:#a16207; padding:1rem; margin-bottom:1rem; border-radius:0.25rem; }
        #login-prompt-btn { font-weight:bold; text-decoration:underline; background:none; padding:0; color:inherit; }
        .tee-time-group { border:1px solid #e5e7eb; border-radius:0.5rem; padding:1rem; background-color:#f9fafb; margin-bottom:1rem; }
        .tee-time-header { display:flex; justify-content:space-between; align-items:center; flex-wrap:wrap; margin-bottom:0.75rem; gap:1rem; }
        .tee-time-details { border-top:1px solid #e5e7eb; padding-top:0.75rem; }

        /* Skill Badges */
        .skill-badge { font-size:0.75rem; font-weight:500; padding:0.125rem 0.5rem; border-radius:9999px; display:inline-block; }
        .skill-beginner { background-color:#dbeafe; color:#1e40af; }
        .skill-intermediate { background-color:#fef9c3; color:#854d0e; }
        .skill-advanced { background-color:#fee2e2; color:#991b1b; }
        .skill-unknown { background-color:#e5e7eb; color:#374151; }

        /* --- About Page Specific --- */
        .about-layout { display:flex; align-items:flex-start; gap:1.5rem; }
        .about-photo { width:192px; height:192px; object-fit:cover; border-radius:0.5rem; box-shadow:0 4px 6px -1px rgba(0,0,0,0.1); }
        @media (max-width:640px) { .about-layout { flex-direction:column; } }

        /* --- User Guide Specific --- */
        .step-number { display:inline-flex; align-items:center; justify-content:center; height:3rem; width:3rem; border-radius:9999px; background-color:#14532d; color:white; font-weight:700; font-size:1.5rem; margin-bottom:0.75rem; }

        /* --- Modal Styles --- */
        .modal { display:none; position:fixed; z-index:2000; left:0; top:0; width:100%; height:100%; overflow:auto; background-color:rgba(0,0,0,0.5); justify-content:center; align-items:center; }
        .modal.is-open { display:flex; }
        .modal-content { background-color:#ffffff; margin:auto; padding:1.5rem; border-radius:0.5rem; box-shadow:0 10px 15px -3px rgba(0,0,0,0.1); width:90%; max-width:500px; }
        .modal-buttons { display:flex; justify-content:flex-end; gap:0.75rem; margin-top:1.5rem; }

        /* Focus outline improvements */
        :focus { outline: 3px solid rgba(34,197,94,0.25); outline-offset: 2px; }

        /* --- Calendar Editor --- */
        #calendar-editor { background-color: #f0fdf4; padding: 1rem; border-radius: 0.5rem; margin-bottom: 1.5rem; border: 1px solid #bbf7d0; }
        #calendar-editor h3 { margin-bottom: 0.75rem; color: #14532d; font-size: 1.125rem; }
        #calendar-editor form { background: none; border: none; padding: 0; margin: 0; }
        #calendar-editor form div { margin-bottom: 0.5rem; }
        #calendar-editor input[type="text"], #calendar-editor input[type="date"] { width: 100%; }
        #calendar-editor .editor-buttons { display: flex; gap: 0.5rem; margin-top: 0.75rem; }
        
        /* Calendar List Styling */
        #calendar-list { list-style-type: none; padding-left: 0; }
        .calendar-event { border: 1px solid #e5e7eb; border-radius: 0.5rem; padding: 1rem; background-color: #f9fafb; margin-bottom: 1rem; }
        .calendar-event-header { display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: 0.5rem; gap: 1rem; }
        .calendar-event-date { font-weight: 600; color: #14532d; font-size: 0.875rem; }
        .calendar-event-title { font-weight: 600; font-size: 1rem; color: #1f2937; margin-bottom: 0.25rem; }
        .calendar-event-details { color: #4b5563; font-size: 0.875rem; }
        .calendar-event-actions { display: flex; gap: 0.5rem; }
        .btn-small { padding: 0.375rem 0.75rem; font-size: 0.875rem; }

        /* --- Footer --- */
        footer { text-align:center; padding:1.5rem; color:#4b5563; font-size:0.875rem; margin-top:2rem; }

        /* Responsive header tweaks */
        @media (max-width: 640px) {
            .header-content { gap: 0.5rem; }
            header h1 { font-size: 1.125rem; }
            .nav-link { padding: 0.4rem 0.6rem; font-size: 0.875rem; }
            .tee-time-header { flex-direction: column; align-items: flex-start; }
            .calendar-event-header { flex-direction: column; }
        }
    </style>
</head>
<body>

    <header>
        <div class="header-content">
            <h1>Golf Battle-Buddy</h1>
            <nav aria-label="main navigation">
                <button class="nav-link" data-page="tee-times" aria-label="Tee Times">Tee Times</button>
                <button class="nav-link" data-page="calendar" aria-label="Calendar">Calendar</button>
                <button class="nav-link" data-page="app-info" aria-label="Application Info">App Info</button>
                <button class="nav-link" data-page="user-guide" aria-label="User Guide">User Guide</button>
                <button class="nav-link" data-page="marketing" aria-label="Marketing">Marketing</button>
                <button class="nav-link" data-page="about" aria-label="About">About</button>
                
                <div id="auth-container">
                    <button id="login-btn" class="btn-blue" aria-haspopup="dialog">Login</button>
                    <div id="user-info" aria-hidden="true">
                        <span id="user-welcome"></span>
                        <button id="logout-btn" class="btn-red">Logout</button>
                    </div>
                </div>
            </nav>
        </div>
    </header>

    <main class="container">
        
        <section id="page-tee-times" class="page-content card" aria-labelledby="tee-times-heading">
            <h2 id="tee-times-heading">Available Tee Times</h2>
            
            <div id="login-prompt" role="status">
                <p>Please <button id="login-prompt-btn">log in</button> to create or join a group.</p>
            </div>

            <form id="create-tee-time-form" autocomplete="off" style="display: none;" aria-hidden="true">
                <h3>Create New Tee Time</h3>
                <div>
                    <label for="player-name">Your Name</label>
                    <input type="text" id="player-name" name="player-name" required aria-required="true" readonly>
                </div>
                <div>
                    <label for="player-skill">Your Skill</label>
                    <select id="player-skill" name="player-skill" required aria-required="true">
                        <option value="" disabled selected>Select skill</option>
                        <option value="Beginner">Beginner +24</option>
                        <option value="Intermediate">Intermediate +10-20</option>
                        <option value="Advanced">Advanced 0 to +10</option>
                    </select>
                </div>
                <div>
                    <label for="tee-date">Date</label>
                    <select id="tee-date" name="tee-date" required aria-required="true"></select>
                </div>
                <div>
                    <label for="tee-time">Time</label>
                    <select id="tee-time" name="tee-time" required aria-required="true">
                        <option value="" disabled selected>Select a time</option>
                    </select>
                </div>
                <button type="submit" class="btn-blue">Create Group</button>
            </form>
            
            <div id="tee-times-list" aria-live="polite">
                <p>Loading tee times...</p>
            </div>
        </section>
        
        <section id="page-calendar" class="page-content card" aria-labelledby="calendar-heading">
            <h2 id="calendar-heading">Upcoming Events</h2>
            
            <div id="calendar-editor">
                <h3>Add Event</h3>
                <form id="calendar-editor-form" autocomplete="off">
                    <div>
                        <label for="event-date">Date</label>
                        <input type="date" id="event-date" name="event-date" required aria-required="true">
                    </div>
                    <div>
                        <label for="event-title">Title</label>
                        <input type="text" id="event-title" name="event-title" required aria-required="true" placeholder="Event name">
                    </div>
                    <div>
                        <label for="event-details">Details</label>
                        <input type="text" id="event-details" name="event-details" placeholder="Additional information (optional)">
                    </div>
                    <div class="editor-buttons">
                        <button type="submit" class="btn-green">Add Event</button>
                        <button type="button" id="clear-all-events-btn" class="btn-red">Clear All</button>
                    </div>
                </form>
            </div>
            
            <ul id="calendar-list"></ul>
        </section>

        <section id="page-app-info" class="page-content card" aria-labelledby="app-info-heading">
            <h2 id="app-info-heading">Application Information</h2>
            <div>
                <h3>Core Features</h3>
                <ul>
                    <li><strong>Real-time Tee Times:</strong> See available groups for today and tomorrow.</li>
                    <li><strong>Create a Group:</strong> Don't see a time you like? Create your own group and let others join you.</li>
                    <li><strong>Join a Group:</strong> Instantly join an existing group with the click of a button.</li>
                    <li><strong>Skill Level Display:</strong> Players can set their skill level (Beginner, Intermediate, Advanced) to find the right match.</li>
                    <li><strong>Event Calendar:</strong> A simple view of upcoming official course events like tournaments and scrambles.</li>
                </ul>
            </div>
            <div>
                <h3>Technical Specifications</h3>
                 <ul>
                    <li><strong>Frontend:</strong> HTML5, CSS, and modern JavaScript.</li>
                    <li><strong>Backend:</strong> gitHub, Heroku,Python(Flask).</li>
                    <li><strong>Database:</strong> Heroku, .</li>
                    <li><strong>Authentication:</strong> Session and Token based Login.</li>
                </ul>
            </div>
        </section>

        <section id="page-user-guide" class="page-content card" aria-labelledby="user-guide-heading">
            <h2 id="user-guide-heading">How-To: User Guide</h2>
            
            <div>
                <span class="step-number">1</span>
                <h3>Log In</h3>
                <p>Click the "Login" button in the header. Since this is a prototype, you can enter any username and password to log in. Your username will be used to identify you in groups.</p>
            </div>
            
            <div>
                <span class="step-number">2</span>
                <h3>Create a Group</h3>
                 <ul>
                    <li>Once logged in, the "Create New Tee Time" form will appear.</li>
                    <li>Your name is auto-filled.</li>
                    <li>Select your skill level (e.g., "Beginner").</li>
                    <li>Choose a date ("Today" or "Tomorrow") and a time.</li>
                    <li>Click "Create Group." Your new group will instantly appear in the list.</li>
                </ul>
            </div>

            <div>
                <span class="step-number">3</span>
                <h3>Join a Group</h3>
                 <ul>
                    <li>Find a group in the "Tee Times" list that isn't full.</li>
                    <li>Click the green "Join Group" button.</li>
                    <li>A pop-up will ask you to confirm your skill level.</li>
                    <li>Click "Join" in the pop-up, and your name will be added to the list for everyone to see.</li>
                </ul>
            </div>
        </section>

        <section id="page-marketing" class="page-content card" aria-labelledby="marketing-heading">
            <h2 id="marketing-heading">Marketing</h2>
             <div>
                <h3>The Problem</h3>
                <p>You want to play a round of golf, but your usual partners are busy or deployed. You're stuck going to the course as a single, hoping to get paired up, or not going at all.</p>
            </div>
             <div>
                <h3>The Solution: Golf Battle-Buddy</h3>
                <p>A simple web app just for local golf course patrons to use. No downloads, no complex sign-ups. Just log in, see who's playing, and request to join them. Better than the white board method some pro-shops use to track tee times.</p>
            </div>
            <div>
                <h3>Target Audience</h3>
                 <ul>
                    <li>Active Duty Service Members</li>
                    <li>Reservists & National Guard</li>
                    <li>Veterans & Retirees</li>
                    <li>Authorized Civilians, Family Members & Patrons</li>
                </ul>
            </div>
        </section>
        
        <section id="page-about" class="page-content card" aria-labelledby="about-heading">
            <h2 id="about-heading">About</h2>
            
            <div class="about-layout">
                
                <div>
                    <p>
                        Hello, I’m Jonathan King—a student, a veteran and golf lover. If you’ve ever been stationed somewhere new or had your schedule constantly changing, you know how hard it can be to find someone to hit the links with. That’s why I built Golf Battle-Buddy: A simple webapp for members of the military community to connect and tee off together, no matter where life takes them.
                    </p>
                    <p style="background-color: #f0fdf4; border: 1px solid #bbf7d0; padding: 0.75rem; border-radius: 0.25rem;">
                        <strong>Questions or comments you can send to:</strong> jonathan.king@mycampus.apus.edu
                    </p>
                </div>
            </div>
            
            <hr style="margin: 2rem 0;">

            <div>
                <h3>Donate to the Prototype</h3>
                <p>
                    Please consider supporting the continued development of Golf Battle-Buddy. Your donations will help cover hosting costs and future enhancements to make this app even better for the military golf community.
                </p>
                <p>
                    <strong>This is a prototype to test the functionality. All data is for testing only and will not be shared with other entities.</strong>
                </p>
                <button id="donate-btn" class="btn-yellow" style="width: 100%; margin-top: 1.5rem;">
                    Future Donation Link
                </button>
            </div>
        </section>
        
    </main>
    
    <div id="app-modal" class="modal" role="dialog" aria-modal="true" aria-labelledby="modal-title" aria-describedby="modal-message" tabindex="-1">
        <div class="modal-content" role="document">
            <h3 id="modal-title">Notice</h3>
            <p id="modal-message">This is a modal message.</p>
            <div class="modal-buttons" style="justify-content: center;">
                <button id="modal-close-btn" class="btn-green" aria-label="Close modal">Close</button>
            </div>
        </div>
    </div>

    <div id="join-modal" class="modal" role="dialog" aria-modal="true" aria-labelledby="join-modal-title" tabindex="-1">
        <div class="modal-content" role="document">
            <form id="join-group-form" autocomplete="off" style="padding: 0; background: none; border: none;">
                <h3 id="join-modal-title">Join Group</h3>
                <p id="join-group-info">You are joining...</p>
                <input type="hidden" id="join-group-index">
                <div>
                    <label for="join-player-name">Your Name</label>
                    <input type="text" id="join-player-name" required aria-required="true" readonly>
                </div>
                <div>
                    <label for="join-player-skill">Your Skill</label>
                    <select id="join-player-skill" required aria-required="true">
                        <option value="" disabled selected>Select skill</option>
                        <option value="Beginner">Beginner +24</option>
                        <option value="Intermediate">Intermediate +10-20</option>
                        <option value="Advanced">Advanced 0 to +10</option>
                    </select>
                </div>
                <div class="modal-buttons">
                    <button type="button" id="join-modal-cancel" class="btn-gray">Cancel</button>
                    <button type="submit" class="btn-green">Join</button>
                </div>
            </form>
        </div>
    </div>

    <div id="auth-modal" class="modal" role="dialog" aria-modal="true" aria-labelledby="auth-modal-title" tabindex="-1">
        <div class="modal-content" role="document">
            <form id="auth-form" autocomplete="off" style="padding: 0; background: none; border: none;">
                <h3 id="auth-modal-title" style="text-align: center;">Login</h3>
                <div>
                    <label for="auth-username">Username</label>
                    <input type="text" id="auth-username" autocomplete="username" required>
                </div>
                <div>
                    <label for="auth-password">Password</label>
                    <input type="password" id="auth-password" autocomplete="current-password" required>
                    <p style="font-size: 0.75rem; color: #4b5563; margin-top: 0.25rem;">Hint: This is a simulation. Any password will work.</p>
                </div>
                <div class="modal-buttons">
                     <button type="button" id="auth-modal-cancel" class="btn-gray">Cancel</button>
                    <button type="submit" id="auth-submit-btn" class="btn-blue">Login</button>
                </div>
            </form>
        </div>
    </div>
    
    <footer>
        <p>A project by Jonathan King. Not an official MWR or DoD application.</p>
    </footer>

    <script>
        // --- App State ---
        let TeeTimes = [];
        let authUser = null; // { name: "John Doe", skill: "Beginner" }
        
        // --- Calendar State ---
        const CAL_KEY = 'CalendarEvents';

        // --- Date Helpers ---
        const today = new Date();
        const tomorrow = new Date();
        tomorrow.setDate(today.getDate() + 1);
        const getMonthAbbr = (date) => date.toLocaleString('default', { month: 'short' });
        const todayDateStr = `${getMonthAbbr(today)} ${today.getDate()}`;
        const tomorrowDateStr = `${getMonthAbbr(tomorrow)} ${tomorrow.getDate()}`;

        // --- Persistent State Helpers (localStorage) ---
        function loadTeeTimes() {
            const stored = localStorage.getItem('TeeTimes');
            let allTimes = [];
            if (stored) allTimes = JSON.parse(stored);
            let validTimes = allTimes.filter(t => t.date === todayDateStr || t.date === tomorrowDateStr);
            if (validTimes.length === 0 && !stored) {
                validTimes = [
                    { date: todayDateStr, time: "08:00", slots: 4, players: [ { name: "Major. Slice", skill: "Advanced" }, { name: "Capt. Hook", skill: "Beginner" } ] },
                    { date: todayDateStr, time: "09:00", slots: 2, players: [ { name: "Sgt. Eagle", skill: "Advanced" } ] },
                    { date: tomorrowDateStr, time: "08:20", slots: 4, players: [ { name: "Fred. Miller", skill: "Intermediate" } ] }
                ];
            }
            TeeTimes = validTimes;
            saveTeeTimes();
        }
        function saveTeeTimes() {
            TeeTimes.sort((a,b) => (a.date < b.date ? -1 : a.date > b.date ? 1 : a.time < b.time ? -1 : a.time > b.time ? 1 : 0));
            localStorage.setItem('TeeTimes', JSON.stringify(TeeTimes));
        }
        async function addTeeTime(newTeeTime) {
            const existing = TeeTimes.find(t => t.date === newTeeTime.date && t.time === newTeeTime.time);
            if (existing) return { success:false, message:
`A tee time for ${newTeeTime.time} on ${newTeeTime.date} already exists.` };
            TeeTimes.push(newTeeTime);
            saveTeeTimes();
            return { success:true, message:
`Your tee time for ${newTeeTime.time} on ${newTeeTime.date} has been created.` };
        }
        async function joinTeeTime(index, newPlayer) {
            if (TeeTimes[index] && TeeTimes[index].players.length < TeeTimes[index].slots) {
                TeeTimes[index].players.push(newPlayer);
                saveTeeTimes();
                return { success:true, message:"You have been added to this group. See you on the green!" };
            }
            return { success:false, message:"Could not join group. It might be full." };
        }

        // --- Calendar Helpers ---
        function loadCalendarEvents() {
            const stored = localStorage.getItem(CAL_KEY);
            if (stored) {
                try {
                    return JSON.parse(stored);
                } catch (e) {
                    console.error('Failed to parse calendar events:', e);
                }
            }
            // Default events
            return [
                { date: tomorrowDateStr, title: 'Sunday Skins Game', details: '' },
                { date: 'Nov 11', title: 'Veterans Day Scramble', details: '' },
                { date: 'Nov 15', title: 'Turkey Shootout', details: '' },
                { date: 'Nov 16', title: 'Weekly Skins Game', details: '' }
            ];
        }
        
        function saveCalendarEvents(events) {
            localStorage.setItem(CAL_KEY, JSON.stringify(events));
        }
        
        function renderCalendarEvents() {
            const cal = document.getElementById('calendar-list');
            if (!cal) return;
            
            const events = loadCalendarEvents();
            
            if (events.length === 0) {
                cal.innerHTML = '<li style="color:#4b5563;font-style:italic;padding:1rem 0;">No events scheduled. Add one using the form above!</li>';
                return;
            }
            
            let html = '';
            events.forEach((event, index) => {
                html += `
                    <li class="calendar-event">
                        <div class="calendar-event-header">
                            <div>
                                <div class="calendar-event-date">${event.date}</div>
                                <div class="calendar-event-title">${event.title}</div>
                                ${event.details ? `<div class="calendar-event-details">${event.details}</div>` : ''}
                            </div>
                            <div class="calendar-event-actions">
                                <button class="btn-blue btn-small edit-event-btn" data-index="${index}">Edit</button>
                                <button class="btn-red btn-small delete-event-btn" data-index="${index}">Delete</button>
                            </div>
                        </div>
                    </li>
                `;
            });
            
            cal.innerHTML = html;
        }
        
        function openEditEvent(index) {
            const events = loadCalendarEvents();
            if (index < 0 || index >= events.length) return;
            
            const event = events[index];
            
            const newDate = prompt('Edit Date:', event.date);
            if (newDate === null) return; // User cancelled
            
            const newTitle = prompt('Edit Title:', event.title);
            if (newTitle === null) return; // User cancelled
            
            const newDetails = prompt('Edit Details (optional):', event.details || '');
            if (newDetails === null) return; // User cancelled
            
            // Update the event
            events[index] = {
                date: newDate.trim() || event.date,
                title: newTitle.trim() || event.title,
                details: newDetails.trim()
            };
            
            saveCalendarEvents(events);
            renderCalendarEvents();
        }

        // --- Simple Auth Helpers ---
        function loginUser(name, skill) {
            authUser = { name, skill: skill || 'Beginner' };
            sessionStorage.setItem('golfUser', JSON.stringify(authUser));
            updateUIForLoggedIn();
        }
        function logoutUser() { authUser = null; sessionStorage.removeItem('golfUser'); updateUIForLoggedOut(); }
        function checkLoginState() {
            const storedUser = sessionStorage.getItem('golfUser');
            if (storedUser) { authUser = JSON.parse(storedUser); updateUIForLoggedIn(); } else { authUser = null; updateUIForLoggedOut(); }
            loadTeeTimes(); renderTeeTimes();
        }

        // --- UI Updates ---
        function updateUIForLoggedIn() {
            const loginBtn = document.getElementById('login-btn');
            const userInfo = document.getElementById('user-info');
            const loginPrompt = document.getElementById('login-prompt');
            const form = document.getElementById('create-tee-time-form');
            if (loginBtn) loginBtn.style.display = 'none';
            if (userInfo) { userInfo.style.display = 'flex'; userInfo.classList.add('active'); userInfo.setAttribute('aria-hidden','false'); }
            if (loginPrompt) loginPrompt.style.display = 'none';
            if (form) { form.style.display = 'block'; form.setAttribute('aria-hidden','false'); }
            const nameInput = document.getElementById('player-name');
            const skillSelect = document.getElementById('player-skill');
            if (nameInput) nameInput.value = authUser.name;
            if (skillSelect) skillSelect.value = authUser.skill || 'Beginner';
            renderTeeTimes();
        }
        function updateUIForLoggedOut() {
            const loginBtn = document.getElementById('login-btn');
            const userInfo = document.getElementById('user-info');
            const loginPrompt = document.getElementById('login-prompt');
            const form = document.getElementById('create-tee-time-form');
            if (loginBtn) loginBtn.style.display = 'inline-block';
            if (userInfo) { userInfo.style.display = 'none'; userInfo.classList.remove('active'); userInfo.setAttribute('aria-hidden','true'); }
            if (loginPrompt) loginPrompt.style.display = 'block';
            if (form) { form.style.display = 'none'; form.setAttribute('aria-hidden','true'); }
            renderTeeTimes();
        }

        function getSkillBadge(skill) {
            const norm = String(skill).toLowerCase();
            if (norm.includes('beginner')) return `<span class="skill-badge skill-beginner">Beginner</span>`;
            if (norm.includes('intermediate')) return `<span class="skill-badge skill-intermediate">Intermediate</span>`;
            if (norm.includes('advanced')) return `<span class="skill-badge skill-advanced">Advanced</span>`;
            return `<span class="skill-badge skill-unknown">Unknown</span>`;
        }

        // --- Render ---
        function renderTeeTimes() {
            const list = document.getElementById('tee-times-list');
            if (!list) return; list.innerHTML = '';
            const todayTimes = TeeTimes.filter(t=>t.date===todayDateStr);
            const tomorrowTimes = TeeTimes.filter(t=>t.date===tomorrowDateStr);
            function renderDay(title, arr, dateStr) {
                let html = `<h3>${title}</h3>`;
                if (arr.length===0) { html+=`<p style="color:#4b5563;font-style:italic">No tee times available for this day.</p>`; return html; }
                arr.forEach(group=>{
                    const idx = TeeTimes.findIndex(t=>t.date===group.date && t.time===group.time);
                    const slotsLeft = group.slots - group.players.length;
                    const playersHtml = group.players.length>0 ? group.players.map(p=>`<li style="display:flex;justify-content:space-between;align-items:center;padding:0.25rem 0;"> <span>${p.name}</span> ${getSkillBadge(p.skill)} </li>`).join('') : `<li style="color:#4b5563;font-style:italic">No players joined yet.</li>`;
                    const isFull = slotsLeft<=0; const isLoggedIn = !!authUser; const alreadyJoined = isLoggedIn && group.players.some(p=>p.name===authUser.name); const joinDisabled = isFull || !isLoggedIn || alreadyJoined;
                    let btnText = 'Login to Join'; if (isLoggedIn) btnText = alreadyJoined ? 'Joined' : (isFull ? 'Full' : 'Join Group');
                    html += `
                    <div class="tee-time-group">
                        <div class="tee-time-header">
                            <div>
                                <h3 style="color:#14532d;">${group.time}</h3>
                                <p style="font-size:0.875rem;color:#4b5563;">${slotsLeft} of ${group.slots} slots available</p>
                            </div>
                            <button class="join-btn btn-green" data-group-index="${idx}" data-group-info="the ${group.time} group on ${group.date}" aria-label="Join this group at ${group.time} on ${dateStr}" ${joinDisabled? 'disabled': ''}>${btnText}</button>
                        </div>
                        <div class="tee-time-details">
                            <h4 style="font-weight:600;font-size:0.875rem;margin-bottom:0.5rem;">Players Joined:</h4>
                            <ul style="list-style-type:none;padding-left:0;">${playersHtml}</ul>
                        </div>
                    </div>`;
                });
                return html;
            }
            list.innerHTML += renderDay(`Today, ${todayDateStr}`, todayTimes, todayDateStr);
            list.innerHTML += renderDay(`Tomorrow, ${tomorrowDateStr}`, tomorrowTimes, tomorrowDateStr);
        }

        // --- Modal utilities: focus trapping & open/close ---
        function getFocusableElements(container) {
            if (!container) return []; const selector = 'a[href], area[href], input:not([disabled]):not([type="hidden"]), select:not([disabled]), textarea:not([disabled]), button:not([disabled]), [tabindex]:not([tabindex="-1"])';
            return Array.from(container.querySelectorAll(selector)).filter(el => el.offsetParent !== null);
        }
        function trapFocus(modal) {
            const focusables = getFocusableElements(modal);
            if (!focusables.length) return (e)=>{}; // noop remover
            let first = focusables[0], last = focusables[focusables.length-1];
            function keyHandler(e) {
                if (e.key === 'Tab') {
                    if (e.shiftKey) {
                        if (document.activeElement === first) { e.preventDefault(); last.focus(); }
                    } else {
                        if (document.activeElement === last) { e.preventDefault(); first.focus(); }
                    }
                }
                if (e.key === 'Escape') {
                    const closeBtn = modal.querySelector('[aria-label="Close modal"]');
                    if (closeBtn) closeBtn.click(); else modal.classList.remove('is-open');
                }
            }
            modal.addEventListener('keydown', keyHandler);
            return function removeTrap() { modal.removeEventListener('keydown', keyHandler); };
        }

        const modal = document.getElementById('app-modal');
        const modalTitle = document.getElementById('modal-title');
        const modalMessage = document.getElementById('modal-message');
        const closeModalBtn = document.getElementById('modal-close-btn');
        let lastFocusedElement = null; let removeModalTrap = null;
        function showModal(title, message) {
            lastFocusedElement = document.activeElement; modalTitle.textContent = title; modalMessage.textContent = message; modal.classList.add('is-open'); modal.setAttribute('aria-hidden','false'); document.body.style.overflow='hidden';
            // trap focus
            removeModalTrap = trapFocus(modal);
            // focus first actionable element in modal
            const focusables = getFocusableElements(modal); if (focusables.length) focusables[0].focus();
        }
        function closeModal() { modal.classList.remove('is-open'); modal.setAttribute('aria-hidden','true'); document.body.style.overflow=''; if (removeModalTrap) removeModalTrap(); if (lastFocusedElement) lastFocusedElement.focus(); }
        if (closeModalBtn) closeModalBtn.addEventListener('click', closeModal);
        modal.addEventListener('click', (e)=>{ if (e.target === modal) closeModal(); });

        // Join modal
        const joinModal = document.getElementById('join-modal');
        const joinModalForm = document.getElementById('join-group-form');
        const joinModalInfo = document.getElementById('join-group-info');
        const joinModalIndexInput = document.getElementById('join-group-index');
        const joinModalNameInput = document.getElementById('join-player-name');
        const joinModalSkillSelect = document.getElementById('join-player-skill');
        const joinModalCancelBtn = document.getElementById('join-modal-cancel');
        let joinModalLastFocus = null; let removeJoinTrap = null;
        function showJoinModal(index, info) {
            joinModalLastFocus = document.activeElement; joinModalInfo.textContent = `You are joining ${info}.`; joinModalIndexInput.value = index; joinModalForm.reset(); if (joinModalNameInput) joinModalNameInput.value = authUser.name; if (joinModalSkillSelect) joinModalSkillSelect.value = authUser.skill || 'Beginner'; joinModal.classList.add('is-open'); joinModal.setAttribute('aria-hidden','false'); document.body.style.overflow = 'hidden'; removeJoinTrap = trapFocus(joinModal); const f = getFocusableElements(joinModal); if (f.length) f[0].focus(); }
        function hideJoinModal() { joinModal.classList.remove('is-open'); joinModal.setAttribute('aria-hidden','true'); document.body.style.overflow=''; if (removeJoinTrap) removeJoinTrap(); if (joinModalLastFocus) joinModalLastFocus.focus(); }
        if (joinModalCancelBtn) joinModalCancelBtn.addEventListener('click', hideJoinModal); joinModal.addEventListener('click', (e)=>{ if (e.target===joinModal) hideJoinModal(); });

        // Auth modal
        const authModal = document.getElementById('auth-modal');
        const authModalForm = document.getElementById('auth-form');
        const authModalCancelBtn = document.getElementById('auth-modal-cancel');
        const authUsernameInput = document.getElementById('auth-username');
        const authPasswordInput = document.getElementById('auth-password');
        let authModalLastFocus = null; let removeAuthTrap = null;
        function showAuthModal() { authModalLastFocus = document.activeElement; authModalForm.reset(); authModal.classList.add('is-open'); authModal.setAttribute('aria-hidden','false'); document.body.style.overflow='hidden'; removeAuthTrap = trapFocus(authModal); if (authUsernameInput) authUsernameInput.focus(); }
        function hideAuthModal() { authModal.classList.remove('is-open'); authModal.setAttribute('aria-hidden','true'); document.body.style.overflow=''; if (removeAuthTrap) removeAuthTrap(); if (authModalLastFocus) authModalLastFocus.focus(); }
        if (authModalCancelBtn) authModalCancelBtn.addEventListener('click', hideAuthModal); authModal.addEventListener('click', (e)=>{ if (e.target===authModal) hideAuthModal(); });
        if (authModalForm) authModalForm.addEventListener('submit', async (e)=>{ e.preventDefault(); const username = authUsernameInput.value; if (username && username.trim()!=='') { loginUser(username.trim(), 'Beginner'); hideAuthModal(); } else { showModal('Login Failed','Please enter a username.'); } });

        // --- Page switching utility ---
        function showPage(pageId) {
            document.querySelectorAll('.page-content').forEach(p => p.classList.remove('active'));
            const target = document.getElementById('page-'+pageId);
            if (target) target.classList.add('active');
            document.querySelectorAll('.nav-link').forEach(link => link.classList.remove('active'));
            const activeLink = document.querySelector(`.nav-link[data-page="${pageId}"]`);
            if (activeLink) activeLink.classList.add('active');
            const pageName = pageId.charAt(0).toUpperCase() + pageId.slice(1).replace('-', ' ');
            document.title = `Golf Battle-Buddy | ${pageName}`;
        }

        // --- DOMContentLoaded setup ---
        document.addEventListener('DOMContentLoaded', () => {
            // populate selects
            function populateDateSelect() { const ds = document.getElementById('tee-date'); if (!ds) return; ds.innerHTML = `<option value="${todayDateStr}">Today, ${todayDateStr}</option><option value="${tomorrowDateStr}">Tomorrow, ${tomorrowDateStr}</option>`; }
            function populateTimeSelect() { const ts = document.getElementById('tee-time'); if (!ts) return; ts.innerHTML = '<option value="" disabled selected>Select a time</option>'; for (let minutes = 7*60; minutes <= 15*60+20; minutes += 20) { const h = String(Math.floor(minutes/60)).padStart(2,'0'); const m = String(minutes%60).padStart(2,'0'); const timeStr = `${h}:${m}`; const option = document.createElement('option'); option.value = timeStr; option.textContent = timeStr; ts.appendChild(option); } }
            populateDateSelect(); populateTimeSelect(); renderCalendarEvents();

            // attach listeners
            const loginBtn = document.getElementById('login-btn'); if (loginBtn) loginBtn.addEventListener('click', showAuthModal);
            const loginPromptBtn = document.getElementById('login-prompt-btn'); if (loginPromptBtn) loginPromptBtn.addEventListener('click', showAuthModal);
            const logoutBtn = document.getElementById('logout-btn'); if (logoutBtn) logoutBtn.addEventListener('click', () => { logoutUser(); showModal('Logged Out','You have been logged out.'); });

            // navigation
            document.querySelectorAll('.nav-link').forEach(link=>{ link.addEventListener('click', (e)=>{ e.preventDefault(); const page = link.dataset.page; if (page) showPage(page); }); });

            // default page and active nav
            showPage('tee-times');

            // create form
            const createForm = document.getElementById('create-tee-time-form'); if (createForm) createForm.addEventListener('submit', async (e)=>{ e.preventDefault(); const player = { name: document.getElementById('player-name').value, skill: document.getElementById('player-skill').value }; const teeDate = document.getElementById('tee-date').value; const teeTime = document.getElementById('tee-time').value; if (!player.name || !player.skill || !teeDate || !teeTime) { showModal('Error','Please fill out all fields to create a tee time.'); return; } const result = await addTeeTime({ date: teeDate, time: teeTime, slots:4, players:[player] }); if (result.success) { renderTeeTimes(); createForm.reset(); document.getElementById('player-name').value = authUser.name; document.getElementById('player-skill').value = authUser.skill || 'Beginner'; document.getElementById('tee-time').selectedIndex = 0; showModal('Success!', result.message); } else { showModal('Error', result.message); } });

            // donate
            const donateBtn = document.getElementById('donate-btn'); if (donateBtn) donateBtn.addEventListener('click', ()=>{ showModal('Donations','Thank you for your interest! The donation system is not yet active. Please check back later.'); });

            // join form
            if (joinModalForm) joinModalForm.addEventListener('submit', async (e)=>{ e.preventDefault(); const index = Number(joinModalIndexInput.value); const player = { name: joinModalNameInput.value, skill: joinModalSkillSelect.value }; if (!player.name || !player.skill) { showModal('Error','Please enter your name and select a skill.'); return; } if (authUser) authUser.skill = player.skill; sessionStorage.setItem('golfUser', JSON.stringify(authUser)); const result = await joinTeeTime(index, player); hideJoinModal(); if (result.success) { renderTeeTimes(); showModal('Group Joined', result.message); } else { showModal('Error', result.message); } });

            // delegated join
            const teeList = document.getElementById('tee-times-list'); if (teeList) teeList.addEventListener('click', (e)=>{ const joinBtn = e.target.closest('.join-btn'); if (joinBtn && !joinBtn.disabled) { const idx = Number(joinBtn.getAttribute('data-group-index')); const info = joinBtn.getAttribute('data-group-info'); showJoinModal(idx, info); } });

            // calendar editor form
            const calendarEditorForm = document.getElementById('calendar-editor-form');
            if (calendarEditorForm) {
                calendarEditorForm.addEventListener('submit', (e) => {
                    e.preventDefault();
                    const dateInput = document.getElementById('event-date');
                    const titleInput = document.getElementById('event-title');
                    const detailsInput = document.getElementById('event-details');
                    
                    const date = dateInput.value;
                    const title = titleInput.value.trim();
                    const details = detailsInput.value.trim();
                    
                    if (!date || !title) {
                        showModal('Error', 'Please enter both a date and title for the event.');
                        return;
                    }
                    
                    // Format date as "Mon DD" to match existing style
                    const dateObj = new Date(date + 'T00:00:00');
                    const formattedDate = `${getMonthAbbr(dateObj)} ${dateObj.getDate()}`;
                    
                    const events = loadCalendarEvents();
                    events.push({
                        date: formattedDate,
                        title: title,
                        details: details
                    });
                    
                    saveCalendarEvents(events);
                    renderCalendarEvents();
                    calendarEditorForm.reset();
                    showModal('Success', 'Event added successfully!');
                });
            }
            
            // clear all events button
            const clearAllBtn = document.getElementById('clear-all-events-btn');
            if (clearAllBtn) {
                clearAllBtn.addEventListener('click', () => {
                    if (confirm('Are you sure you want to delete all events? This cannot be undone.')) {
                        saveCalendarEvents([]);
                        renderCalendarEvents();
                        showModal('Cleared', 'All events have been removed.');
                    }
                });
            }
            
            // delegated edit and delete for calendar events
            const calendarList = document.getElementById('calendar-list');
            if (calendarList) {
                calendarList.addEventListener('click', (e) => {
                    const editBtn = e.target.closest('.edit-event-btn');
                    const deleteBtn = e.target.closest('.delete-event-btn');
                    
                    if (editBtn) {
                        const index = Number(editBtn.getAttribute('data-index'));
                        openEditEvent(index);
                    } else if (deleteBtn) {
                        const index = Number(deleteBtn.getAttribute('data-index'));
                        if (confirm('Are you sure you want to delete this event?')) {
                            const events = loadCalendarEvents();
                            events.splice(index, 1);
                            saveCalendarEvents(events);
                            renderCalendarEvents();
                        }
                    }
                });
            }

            // initial state
            checkLoginState();
        });
    </script>
</body>
</html>
